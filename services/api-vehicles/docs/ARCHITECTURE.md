






# Keyswitch Architecture Overview

## System Components

```
┌───────────────┐       ┌─────────────┐
│   Guest App   │◄──────▶│  Web API    │
└───────────────┘       └─────────────┘
          ▲                   ▲
          │                   │
          │                   ▼
┌───────────────┐       ┌─────────────┐
│   Host App    │◄──────▶│  Web API    │
└───────────────┘       └─────────────┘
          ▲                   ▲
          │                   │
          │                   ▼
┌───────────────┐       ┌─────────────┐
│   Admin App   │◄──────▶│  Web API    │
└───────────────┘       └─────────────┘
          ▲                   ▲
          │                   │
          ▼                   ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│  ┌───────────┐   ┌─────────┐   ┌────────────┐   ┌─────────────┐             │
│  │   Users   │◄▶│ Vehicles │◄▶│ Listings   │◄▶│ Bookings    │◄───────────▶│
│  └───────────┘   └─────────┘   └────────────┘   └─────────────┘             │
│                                                                              │
│  ┌───────────┐   ┌──────────┐   ┌────────────┐   ┌─────────────┐            │
│  │ Payments  │◄▶│ Risk      │◄▶│ Claims     │◄▶│ Notifications│◄───────────▶│
│  └───────────┘   └──────────┘   └────────────┘   └─────────────┘            │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘

```

## Data Flow

1. **Guest App**: Search → Select Listing → Book → Pay Deposit → Check-in/out
2. **Host App**: Onboard Vehicle → Manage Calendar → View Bookings → Process Claims
3. **Admin App**: Manage Airports → Resolve Disputes → Monitor Fraud

## Key Services

- **API Service** (NestJS): Main business logic and REST endpoints
- **Risk Service** (NestJS Worker): Risk assessment calculations
- **Ingest Service** (NestJS): Telemetry data processing from OBD-II devices

## Database Schema

```
┌───────────┐       ┌─────────────┐       ┌──────────┐
│   User    │◄──────▶│ HostProfile │◄──────▶│ Vehicle  │
└───────────┘       └─────────────┘       └──────────┘
          ▲                   ▲               ▲
          │                   │               │
          ▼                   ▼               ▼
┌───────────────┐       ┌─────────────┐       ┌────────────┐
│ GuestProfile  │◄──────▶│ Listing    │◄──────▶│ Booking   │
└───────────────┘       └─────────────┘       └────────────┐
          ▲                   ▲               ▲            │
          │                   │               │            ▼
          ▼                   ▼               ▼    ┌──────────────┐
┌───────────────┐       ┌─────────────┐       ││ Checkpoint   │◄────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────>
└───────────────┘       ┌─────────────┐       ││ Claim        │
          ▲                   ▼               │└──────────────┘
          │           ┌─────────────┐         └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────>
└───────────────┘       ││ ProtectionPlan │
          ▲                   ▼               ┌─────────────┐
          │           ┌─────────────┐         │ PayoutAccount│
          │           │ Airport     │◄────────▶│ Transfer    │
          │           └─────────────┘         │ Charge      │
          ▼                   ▲               │ Deposit     │
┌───────────────┐       ┌─────────────┐         │ RiskAssessment│
│ TelematicsDevice│◄──────▶│ AirportZone│         └─────────────┘
└───────────────┘       └─────────────┘

```

## Technology Stack

- **Frontend**: Next.js (web), Expo React Native (mobile)
- **Backend**: NestJS for all services
- **Database**: PostgreSQL with Prisma ORM
- **Caching/Queues**: Redis
- **File Storage**: S3-compatible storage
- **Payments**: Stripe Connect

## Compliance & Security

- Airport compliance by design
- Immutable audit logs for airport transactions
- KYC/KYB verification flows
- Risk-based deposit scaling




